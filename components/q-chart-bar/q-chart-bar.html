<link rel="import" href="/bower_components/polymer/polymer.html">
<script src="/bower_components/d3/d3.min.js"></script>

<polymer-element name="q-chart-bar" extends="q-chart" attributes="url label">
  <template>
    <style>
      :host {
        display: block;
      }

/*      .bar {
        fill: steelblue;
      }

      .bar:hover {
        fill: brown;
      }

      .axis {
        font: 10px sans-serif;
      }

      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      .x.axis path {
        display: none;
      }*/
    </style>
    <svg id="chart"></svg>
  </template>
  <script>
    (function () {

      Polymer('q-chart-bar', {
        label:null,
         start: function () {

        },
        stop: function () {

        },
        render: function () {
          this.isRendered = true;

          var self = this;
          var data = self.data.data;
          var w = this.clientWidth / data.length;
          var h = this.clientHeight;
          var colors = this.colors;
          var fontColors = this.fontColors;

          var max = d3.max(data, function(d) {
            return d.value;
          });

          var xScale = d3.scale.linear()
              .domain([0, 1])
              .range([0, w]);

          var yScale = d3.scale.linear()
             .domain([0, max])
             .rangeRound([0, h]);

          this.chart.selectAll("rect")
             .data(data)
             .enter().append("rect")
             .attr("x", function(d, i) { console.log(xScale(i)); return xScale(i) - .5; })
             .attr("y", function(d) { return h - .5; })
             .attr("width", w)
             .transition().delay(function (d,i){ return i * 300;}).duration(300)
             .attr("height", function(d) { return yScale(d.value); })
             .attr("y", function(d) { return h - yScale(d.value) - .5; })
             .attr("fill", function (d, i) { return colors(0); });

          this.chart.selectAll("text")
             .data(data)
             .enter()
             .append("text")
             .text(function(d) {
                  return d.value + self.label;
             }).attr("x", function(d, i) {
                  return xScale(i) - .5;
             })
             .attr("y", function(d) {
                  return h - yScale(d.value) + 15;
             })
             .attr("fill", function (d, i) { return fontColors(0); })
             .attr('opacity', '0')
             .transition().delay(function (d,i){ return i * 300 + 300;}).duration(300)
             .attr('opacity', '1');
        }
      });

    })();
  </script>
</polymer-element>